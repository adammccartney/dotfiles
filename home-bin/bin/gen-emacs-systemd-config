#!/bin/sh
# gen-emacs-systemd-config
# Generate a ValuesFile that can be used to configure the systemd service


# Activate the "host" profile if it exists
if [ -d $HOME/.guix-extra-profiles/$(hostname)/$(hostname) ]; then
    GUIX_PROFILE="$HOME/.guix-extra-profiles/$(hostname)/$(hostname)"
    . "$GUIX_PROFILE/etc/profile"
fi

# Otherwise emacs may be in either the default guix profile or somewhere else
# (where sane people install stuff!)


# Set up the linker

# Get pat
EMACS_EXE=$(type -P emacs)
EMACSCLIENT_EXE=$(which emacsclient)

# now write an environment file
DOTFILES=$(pwd)
EMACS_CONFIG=${DOTFILES}/systemd/.config/systemd/user/etc/emacs.conf
touch ${EMACS_CONFIG} && cat > ${EMACS_CONFIG} <<EOF
# Do Not Edit! This file was generated by ~/dotfiles/scripts/gen-emacs-systemd-config
$(env)
LD_LIBRARY_PATH="${GUIX_PROFILE}/lib"
XMODIFIERS=''
EMACS_CMD="$EMACS_EXE --daemon"
EMACSCLIENT_EXE=$EMACSCLIENT_EXE
EOF
